<!doctype html>
<html>
<head>
  <!-- ga -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-143166577-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'UA-143166577-1');
  </script>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Griddler Express</title>
  <link rel="shortcut icon" href="favicon.ico" type="image/x-icon"/>
  <style>.ne14-popup .labels{display:flex}.ne14-popup .labels input{width:30px;text-align:center;margin:.3em;border:1px solid #ddd;border-radius:.3em;font-size:16px}.ne14-popup .labels input:focus{border-color:#42bd44;outline:0;box-shadow:inset 0 1px 1px rgba(0,0,0,.075),0 0 8px rgba(104,195,82,0.6);background-color:#42bd44;color:#fff}.ne14-popup .labels input::selection{background-color:#006400;color:#fff}.ne14-popup .labels input.error{border-color:red;background-color:#ffc0cb;color:red}.ne14-popup .labels input.error:focus{box-shadow:inset 0 1px 1px rgba(0,0,0,.075),0 0 8px rgba(255,0,0,0.6)}.ne14-popup .labels input.error::selection{background-color:red}.ne14-popup .errors{margin-top:.5em;font-weight:700;color:red;display:block}.ne14-popup .buttons{display:flex;justify-content:flex-end}.ne14-popup .btn{background:#0070ff;color:#fff;cursor:pointer;padding:.3em .7em;margin:.3em;border-radius:.3em}.ne14-popup.invalid .btn{background:#ddd;color:#444}.ne14-popup .json{width:600px;max-width:90vw;min-width:300px;height:480px;max-height:80vh;min-height:180px}</style>
  <script>"use strict";var TESTGRID_GCHQ={rows:[{labels:[7,3,1,1,7]},{labels:[1,1,2,2,1,1]},{labels:[1,3,1,3,1,1,3,1]},{labels:[1,3,1,1,6,1,3,1]},{labels:[1,3,1,5,2,1,3,1]},{labels:[1,1,2,1,1]},{labels:[7,1,1,1,1,1,7]},{labels:[3,3]},{cells:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0],labels:[1,2,3,1,1,3,1,1,2]},{labels:[1,1,3,2,1,1]},{labels:[4,1,4,2,1,2]},{labels:[1,1,1,1,1,4,1,3]},{labels:[2,1,1,1,2,5]},{labels:[3,2,2,6,3,1]},{labels:[1,9,1,1,2,1]},{labels:[2,1,2,2,3,1]},{cells:[0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0],labels:[3,1,1,1,1,5,1]},{labels:[1,2,2,5]},{labels:[7,1,2,1,1,1,3]},{labels:[1,1,2,1,2,2,1]},{labels:[1,3,1,4,5,1]},{labels:[1,3,1,3,10,2]},{labels:[1,3,1,1,6,6]},{labels:[1,1,2,1,1,2]},{labels:[7,2,1,2,5]}],columns:[{labels:[7,2,1,1,7]},{labels:[1,1,2,2,1,1]},{labels:[1,3,1,3,1,3,1,3,1]},{labels:[1,3,1,1,5,1,3,1]},{labels:[1,3,1,1,4,1,3,1]},{labels:[1,1,1,2,1,1]},{labels:[7,1,1,1,1,1,7]},{labels:[1,1,3]},{labels:[2,1,2,1,8,2,1]},{labels:[2,2,1,2,1,1,1,2]},{labels:[1,7,3,2,1]},{labels:[1,2,3,1,1,1,1,1]},{labels:[4,1,1,2,6]},{labels:[3,3,1,1,1,3,1]},{labels:[1,2,5,2,2]},{labels:[2,2,1,1,1,1,1,2,1]},{labels:[1,3,3,2,1,8,1]},{labels:[6,2,1]},{labels:[7,1,4,1,1,3]},{labels:[1,1,1,1,4]},{labels:[1,3,1,3,7,1]},{labels:[1,3,1,1,1,2,1,1,4]},{labels:[1,3,1,4,3,3]},{labels:[1,1,2,2,2,6,1]},{labels:[7,1,3,2,1,1]}]};!function(e){var t=function(e,n){var l,i,r,a,o,s,c={};for(l in n="object"==typeof n?n:{},e)e.hasOwnProperty(l)&&(a=typeof(i=e[l]),o=typeof(r=n[l]),s=null!=r&&o===a,c[l]=s?"object"!==a?r:t(i,r):i,null!=r&&o!==a&&console.warn('Merge type-mismatch on "'+l+'". Expected:',a,"Actual:",o));return c},n=function(e,t){var l,i,r,a=[];for(l in t="string"==typeof t?t:"",e)if(e.hasOwnProperty(l)){if("function"===(r=typeof(i=e[l])))continue;"object"===r&&i.constructor!==Array?a=a.concat(n(i,t+l+".")):a.push(encodeURIComponent(t+l)+"="+encodeURIComponent(i))}return""===t?a.join("&"):a};e.ne14=e.ne14||{},e.ne14.utils={empty:function(e){for(;e.firstChild;)e.removeChild(e.firstChild)},remove:function(e){e&&e.parentNode&&e.parentNode.removeChild(e)},merge:t,serialise:n,fire:function(e,t,n){var l=document.createEvent("CustomEvent");l.initCustomEvent(e,!0,!0,n),t.dispatchEvent(l)},addStyle:function(e){var t=document.createElement("style");t.type="text/css",t.innerHTML=e,document.body.appendChild(t)},profile:function(e,t){var n=(new Date).getTime(),l=(t.call(),(new Date).getTime()-n);console.log(e,"completed in",l,"ms")},stringify:function(e,t){return JSON.stringify(e,null,!0===t?2:null)}}}(window),function(e,t){var n=Object.freeze({title:"",defer_opening:!1,allow_move:!0,easy_close:!0});function l(l,i){var r=ne14.utils.merge(n,i);this.open=function(){s()},this.close=function(){c()};var a,o=function(){var e=t.createElement("div"),l=t.createElement("h1"),i=t.createElement("span");return l.innerHTML=r.title,l.style.margin="0",l.style.fontSize=".8em",i.innerHTML="&times;",i.style.position="absolute",i.style.top=".2em",i.style.right=".2em",i.style.padding="0 .3em",i.style.color="#fff",i.style.cursor="pointer",i.style.backgroundColor="#f00",i.style.borderRadius=".3em",e.style.padding=".35em 1.35em .25em .35em",e.style.position="relative",e.style.borderRadius=".3em .3em 0 0",e.style.backgroundColor="rgba(0,0,0,.1)",e.appendChild(l),e.appendChild(i),i.addEventListener("mousedown",c),!0===n.allow_move&&(e.style.cursor="move",e.addEventListener("mousedown",u)),e},s=function(){h.style.display="block",setTimeout(function(){ne14.utils.fire("opening",l),h.style.opacity="1",f.style.backgroundColor="rgba(0,0,0,.4)"})},c=function(t){!0!==t&&ne14.utils.fire("closing",l),f.addEventListener("transitionend",function(){ne14.utils.remove(f)}),h.style.opacity="0",f.style.backgroundColor="transparent",e.removeEventListener("mouseup",d)},u=function(t){h.style.userSelect="none",a={x:t.clientX-h.offsetLeft,y:t.clientY-h.offsetTop},e.addEventListener("mousemove",p)},d=function(t){null!=a&&ne14.utils.fire("moved",l),h.style.userSelect="text",a=null,e.removeEventListener("mousemove",p)},p=function(t){var n=t.clientX-a.x,l=t.clientY-a.y,i=e.innerWidth-h.clientWidth,r=e.innerHeight-h.clientHeight;n=Math.max(0,Math.min(i,n)),l=Math.max(0,Math.min(r,l));var o=100*n/e.innerWidth,s=100*l/e.innerHeight;h.style.left=o.toFixed(2)+"%",h.style.top=s.toFixed(2)+"%"};e.addEventListener("mouseup",d),l.style.padding=l.style.padding||"1em",l.addEventListener("close",function(){c(!0)});var f=function(){var e=t.createElement("span");return e.style.position="fixed",e.style.left=0,e.style.right=0,e.style.top=0,e.style.bottom=0,e.style.transition="background-color .2s",e.style.display="flex",e.style.justifyContent="center",e.style.alignItems="center",e.style.zIndex=9999,e.style.backgroundColor="transparent",!0===r.easy_close&&e.addEventListener("click",c),e}(),h=function(){var e=t.createElement("span");return e.style.backgroundColor="#fff",e.style.borderRadius=".3em",e.style.boxShadow="-.3em .3em .5em rgba(0,0,0,.2)",e.style.boxSizing="border-box",e.style.border="2px solid rgba(0,0,0,.3)",e.style.display="none",e.style.position="fixed",e.style.opacity="0",e.style.transition="opacity .2s",e.appendChild(o()),e.addEventListener("click",function(e){e.stopPropagation()}),e}();h.style.userSelect="text",h.appendChild(l),f.appendChild(h),t.body.appendChild(f),!0!==r.defer_opening&&this.open()}e.ne14=e.ne14||{},e.ne14.popup={init:function(e,t){return new l(e,t)}}}(window,document);var exports={},__extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function l(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(l.prototype=n.prototype,new l)}}();Object.defineProperty(exports,"__esModule",{value:!0});var CellSetBase=function(){return function(e,t,n,l){this.start=e,this.type=t,this.index=n,this.size=l,this.end=this.start+this.size-1}}(),BlockSet=function(e){function t(t,n,l,i,r){var a=e.call(this,t,n,l,i)||this;return a.start=t,a.type=n,a.index=l,a.size=i,a.spaceIndex=r,a}return __extends(t,e),t}(CellSetBase),SpaceSet=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(CellSetBase),FullSet=function(e){function t(t,n,l,i,r){var a,o=e.call(this,t,n,l,i.length)||this;o.start=t,o.type=n,o.index=l,o.cells=i,o.labelSpaceMap=[],o.labelBlockMap=[],o.spaces=[],o.blocks=[],o.altType=o.type===SetType.Row?SetType.Column:SetType.Row,o.labels=r.map(function(e,t){return new Label(e,t)}),o.indexRef=SetType[o.type].substr(0,3)+" "+o.index,o.performCellPass(!0),o.performCellPass(!1),o.setLabelSpaces(),o.setLabelBlocks();do{a=o.updateMaps(),o.applyBlockValueRanges(),a=(a=a||o.applyBlockPositionRanges())||o.applyDistinctBlockPairing()}while(a);return o}return __extends(t,e),Object.defineProperty(t.prototype,"stateRef",{get:function(){return""+this.cells.map(function(e){return String.fromCharCode(e)}).join("")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"consoleRef",{get:function(){return this.indexRef+": "+this.stateRef+" "+this.labelRef},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"labelRef",{get:function(){return this.labels.map(function(e){return e.value}).join(".")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"labelsRef",{get:function(){var e=this;return this.labels.map(function(t,n){return e.getLabelRef(n)}).join(" / ")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"solved",{get:function(){return!this.cells.some(function(e){return e===CellState.Blank})},enumerable:!0,configurable:!0}),t.prototype.solve=function(){var e=this,t=this.cells.map(function(e,t){return{c:e,i:t}}).filter(function(e){return e.c===CellState.Blank}),n=this.labels.reduce(function(e,t){return e.filter(function(e){return e.i<t.earliest||e.i>t.latest})},t).map(function(e){return e.i}),l=this.labels.reduce(function(e,n){return e.concat(t.filter(function(e){return e.i<n.earliest+n.value&&e.i>n.latest-n.value}))},[]).map(function(e){return e.i});this.blocks.filter(function(e){return e.rightEdge!==e.end||e.leftEdge!==e.start}).forEach(function(e){return t.filter(function(t){return t.i>=e.leftEdge&&t.i<=e.rightEdge}).forEach(function(e){return l.push(e.i)})}),this.blocks.filter(function(e){return 1+e.rightEdge-e.leftEdge===e.maxSize}).forEach(function(e){n.push(e.leftEdge-1),n.push(e.rightEdge+1)});var i=t.filter(function(e){return-1!==n.indexOf(e.i)}).map(function(e){return e.i}).sort(function(e,t){return e<t?-1:e>t?1:0}),r=t.filter(function(e){return-1!==l.indexOf(e.i)}).map(function(e){return e.i}).sort(function(e,t){return e<t?-1:e>t?1:0});return i.forEach(function(t){return e.cells[t]=CellState.Marked}),r.forEach(function(t){return e.cells[t]=CellState.Filled}),{marks:i,fills:r}},t.prototype.getLabelRef=function(e){var t=this.labels[e],n=this.getLinksForLabel(e,!0).map(function(e){return e.setIndex+(e.known?"K":"M")}),l=this.getLinksForLabel(e,!1).map(function(e){return e.setIndex+(e.known?"K":"M")});return t.indexRef+": R="+t.earliest+"-"+t.latest+" S="+n+" B="+l},t.prototype.getLinksForLabel=function(e,t){return(t?this.labelSpaceMap:this.labelBlockMap).filter(function(t){return t.labelIndex===e})},t.prototype.getLinksForSet=function(e,t){return(t?this.labelSpaceMap:this.labelBlockMap).filter(function(t){return t.setIndex===e})},t.prototype.deleteLink=function(e,t,n){var l=n?"labelSpaceMap":"labelBlockMap";this[l]=this[l].filter(function(n){return n.labelIndex!==e||n.setIndex!==t})},t.prototype.upsertLink=function(e,t,n,l){var i=n?this.labelSpaceMap:this.labelBlockMap,r=i.filter(function(n){return n.labelIndex===e&&n.setIndex===t});1===r.length?r[0].known=l:i.push(new LabelSetLink(e,t,l))},t.prototype.upsertLinks=function(e,t,n,l){var i=this;n.forEach(function(n){return i.upsertLink(e,n.index,t,l)})},t.prototype.performCellPass=function(e){var t=this,n=-1,l=-1,i=-1,r=-1,a=[],o=e?0:this.labels.length-1,s=e?this.cells.slice(0):this.cells.slice(0).reverse(),c=e?1:-1;s.concat([CellState.Marked]).forEach(function(s,u){-1===n&&s!==CellState.Marked&&(n=u,r=u),-1===l&&s===CellState.Filled&&(l=u);var d=t.labels[o];d&&-1!==r&&u-r>=d.value&&(-1!==l?r=u-d.value:(e?d.earliest=r:d.latest=t.cells.length-(r+1),r+=1+d.value,o+=c));var p,f=t.spaces.length;if(-1!==l&&s!==CellState.Filled){var h=u-l;a.push(new BlockSet(l,t.type,++i,h,f)),d&&h>d.value&&(r=u+1),d&&u-r===d.value&&(e?d.earliest=r:d.latest=t.cells.length-(r+1),o+=c,r+=1+d.value),l=-1}if(-1!==n&&s===CellState.Marked){if(e){var m=new SpaceSet(n,t.type,f,u-n);t.spaces.push(m),(p=t.blocks).push.apply(p,a)}d&&d.index===o&&u-r>=d.value&&(e?d.earliest=r:d.latest=t.cells.length-(r+1),o+=c),a=[],n=-1,r=t.cells.length}})},t.prototype.setLabelSpaces=function(){var e=this;this.labels.forEach(function(t){var n=e.spaces.filter(function(e){return t.earliest<=e.end&&t.latest>=e.start});if(0===n.length)throw new RangeError("At least one label could not be assigned - "+e.consoleRef);e.upsertLinks(t.index,!0,n,1===n.length)})},t.prototype.setLabelBlocks=function(){var e=this;this.labels.forEach(function(t){var n=e.getLinksForLabel(t.index,!0).reduce(function(n,l){var i=e.blocks.filter(function(e){return e.start>=t.earliest&&e.end<=t.latest&&e.size<=t.value});return n.concat(i)},[]);e.upsertLinks(t.index,!1,n,!1)})},t.prototype.updateMaps=function(){var e=this,t=!1;return this.blocks.forEach(function(n){var l=e.labelBlockMap.filter(function(e){return e.setIndex===n.index});if(1===l.length){var i=l[0].labelIndex,r=e.labels[i];e.upsertLink(i,n.index,!1,!0);var a=e.spaces.filter(function(e){return e.index===n.spaceIndex})[0];r.earliest=Math.max(r.earliest,a.start,1+n.end-r.value),r.latest=Math.min(r.latest,a.end,n.start+r.value-1),e.getLinksForLabel(i,!0).map(function(t){return e.spaces[t.setIndex]}).filter(function(e){return r.earliest>e.end||r.latest<e.start}).forEach(function(t){return e.deleteLink(i,t.index,!0)}),e.getLinksForLabel(i,!0).filter(function(e,t,n){return 1===n.length}).forEach(function(t){return e.upsertLink(i,t.setIndex,!0,!0)}),e.labelBlockMap.filter(function(e){return e.setIndex!==n.index&&e.labelIndex===i}).map(function(t){return e.blocks[t.setIndex]}).filter(function(e){return e.start>r.latest||e.end<r.earliest}).forEach(function(n){t=!0,e.deleteLink(i,n.index,!1)})}}),t},t.prototype.applyBlockValueRanges=function(){var e=this;this.blocks.forEach(function(t){t.minSize=e.cells.length,t.maxSize=0,e.getLinksForSet(t.index,!1).map(function(t){return e.labels[t.labelIndex]}).forEach(function(e){t.minSize=Math.min(t.minSize,e.value),t.maxSize=Math.max(t.maxSize,e.value)})})},t.prototype.applyBlockPositionRanges=function(){var e=this,t=!1;return this.blocks.forEach(function(n,l){var i=e.spaces.filter(function(e){return e.index===n.spaceIndex})[0],r=e.blocks.filter(function(e){return e.spaceIndex===n.spaceIndex}),a=r.filter(function(e){return e.index===l-1&&1+n.start-e.maxSize>e.end})[0],o=r.filter(function(e){return e.index===l+1&&n.end+e.maxSize-1<e.start})[0],s=null==a?i.start:a.end+2,c=null==o?i.end:o.start-2;a&&(t=t||e.tryRemoveLinks(l,!1)),o&&(t=t||e.tryRemoveLinks(l,!0)),n.leftEdge=Math.min(n.start,1+c-n.minSize),n.rightEdge=Math.max(n.end,s+n.minSize-1),(n.leftEdge<n.start||n.rightEdge>n.end)&&e.labelBlockMap.filter(function(e){return e.setIndex===n.index&&e.known}).forEach(function(t){var l=e.labels[t.labelIndex];l.earliest=Math.max(l.earliest,i.start,1+n.rightEdge-l.value),l.latest=Math.min(l.latest,i.end,n.leftEdge+l.value-1)})}),t},t.prototype.tryRemoveLinks=function(e,t){var n=t?e+1:e-1,l=this.getLinksForSet(e,!1),i=this.getLinksForSet(e,!1).map(function(e){return e.labelIndex}).join(","),r=this.getLinksForSet(n,!1).map(function(e){return e.labelIndex}).join(",");return 2===l.length&&r===i&&(this.deleteLink(l[t?0:1].labelIndex,n,!1),this.deleteLink(l[t?1:0].labelIndex,e,!1),!0)},t.prototype.applyDistinctBlockPairing=function(){var e,t,n,l,i=this,r=[];return this.blocks.forEach(function(e,a){t=i.blocks[a-1],n=t&&t.spaceIndex===e.spaceIndex&&t.start+t.maxSize-1>=e.rightEdge,l=n?r.length-1:r.length,r[l]=r[l]||[],r[l].push(a)}),r.length===this.labels.length&&(this.labels.forEach(function(t){i.getLinksForLabel(t.index,!1).filter(function(e){return-1===r[t.index].indexOf(e.setIndex)}).forEach(function(t){e=!0,i.deleteLink(t.labelIndex,t.setIndex,!1)})}),e)},t}(CellSetBase),SolveResult=function(){return function(e,t,n){this.solved=t,this.solvedMs=n,t?this.grid=e:this.brokenGrid=e}}();exports.SolveResult=SolveResult;var HintResult=function(){return function(e){this.test=e}}();exports.HintResult=HintResult;var CellState,SetType,Grid=function(){function e(){}return e.load=function(t){var n=new e;return n.init(t.columns.length,t.rows.length),t.columns.forEach(function(e,t){n.setLabels(SetType.Column,t,e.labels)}),t.rows.forEach(function(e,t){n.setLabels(SetType.Row,t,e.labels),(e.cells||[]).map(function(e,t){return{oState:e,idx:t}}).filter(function(e){return 0!==e.oState}).forEach(function(e){var l=1===e.oState?CellState.Filled:CellState.Marked;n.setState(SetType.Row,t,e.idx,l)})}),n},e.solve=function(t){return e.load(t).solve()},e.hint=function(t){return e.load(t).hint()},Object.defineProperty(e.prototype,"consoleRef",{get:function(){var e=this;return this._rowLabelCache.map(function(t,n){return e.getFullSet(SetType.Row,n).stateRef}).join("\r\n")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"unsolvedCellCount",{get:function(){return this._cellCache.reduce(function(e,t){return e.concat(t)},[]).filter(function(e){return e===CellState.Blank}).length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"solved",{get:function(){return!this._cellCache.reduce(function(e,t){return e.concat(t)},[]).some(function(e){return e===CellState.Blank})},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"gridObject",{get:function(){var e=this;return{columns:this._columnLabelCache.map(function(t,n){return{labels:e.getLabels(SetType.Column,n)}}),rows:this._rowLabelCache.map(function(t,n){return{labels:e.getLabels(SetType.Row,n),cells:e.getFullSet(SetType.Row,n).cells.map(function(e){return e===CellState.Marked?2:CellState.Filled?1:0})}})}},enumerable:!0,configurable:!0}),e.prototype.init=function(e,t){var n=this;this.width=e,this.height=t,this._rowLabelCache=Utils.fillArray(this.height,function(){return[]}),this._columnLabelCache=Utils.fillArray(this.width,function(){return[]}),this._cellCache=this._columnLabelCache.map(function(e){return Utils.fillArray(n.height,function(){return CellState.Blank})})},e.prototype.hint=function(){var e=Utils.fillArray(this.width,function(){return 0}).map(function(e,t){return t}),t=Utils.fillArray(this.height,function(){return 0}).map(function(e,t){return t}),n=this.solveSetsRecursively([e,t],!0);return new HintResult(n)},e.prototype.solve=function(){var e=(new Date).getTime(),t=Utils.fillArray(this.width,function(){return 0}).map(function(e,t){return t}),n=Utils.fillArray(this.height,function(){return 0}).map(function(e,t){return t});this.solveSetsRecursively([t,n]);var l=(new Date).getTime();return new SolveResult(this.gridObject,this.solved,l-e)},e.prototype.setState=function(e,t,n,l){e===SetType.Row?this._cellCache[n][t]=l:this._cellCache[t][n]=l},e.prototype.setLabels=function(e,t,n){var l=SetType[e].substr(0,3)+" "+t,i=e===SetType.Row?this._rowLabelCache:this._columnLabelCache;if(null==i[t]){var r="Not found";throw new RangeError(l+": "+r)}var a=e===SetType.Row?this.width:this.height,o=Label.minSize(n);if(o>a){r="The minimum total label size ("+o+") exceeds the set length ("+a+")";throw new RangeError(l+": "+r)}i[t]=n},e.prototype.getFullSet=function(e,t){var n=e===SetType.Row?this._cellCache.map(function(e){return e[t]}):this._cellCache[t];return new FullSet(0,e,t,n,this.getLabels(e,t))},e.prototype.getLabels=function(e,t){return e===SetType.Row?this._rowLabelCache[t]:this._columnLabelCache[t]},e.prototype.solveSetsRecursively=function(e,t){var n=this;void 0===t&&(t=!1);var l=e[0].map(function(e){return n.getFullSet(SetType.Column,e)}).concat(e[1].map(function(e){return n.getFullSet(SetType.Row,e)})).filter(function(e){return!e.solved}).map(function(e){var t=e.solve();return t.marks.forEach(function(t){return n.setState(e.type,e.index,t,CellState.Marked)}),t.fills.forEach(function(t){return n.setState(e.type,e.index,t,CellState.Filled)}),{crIdx:t.marks.concat(t.fills),crType:e.altType}}).filter(function(e){return 0!==e.crIdx.length});if(t)return l;var i=l.reduce(function(e,t){return(n=e[t.crType]).push.apply(n,t.crIdx),e;var n},[[],[]]).map(function(e){return e.sort(function(e,t){return e<t?-1:e>t?1:0}).filter(function(e,t,n){return!t||e!==n[t-1]})});return i[0].length+i[1].length!==0&&this.solveSetsRecursively([i[0],i[1]]),null},e}();exports.Grid=Grid,function(e){e[e.Blank=9723]="Blank",e[e.Marked=9635]="Marked",e[e.Filled=9724]="Filled"}(CellState=exports.CellState||(exports.CellState={})),function(e){e[e.Column=0]="Column",e[e.Row=1]="Row"}(SetType=exports.SetType||(exports.SetType={}));var LabelSetLink=function(){return function(e,t,n){this.labelIndex=e,this.setIndex=t,this.known=n}}(),Label=function(){function e(e,t){this.value=e,this.index=t,this.indexRef="L"+this.index}return e.minSize=function(e){return e.reduce(function(e,t){return e>0?t+e+1:t+e},0)},e}(),Utils=function(){function e(){}return e.fillArray=function(e,t){for(var n=new Array(e),l=0;l<e;l++)n[l]=t();return n},e}();!function(e,t){var n=Object.freeze({cell_size:20,cell_group:5,grid_minor:"#ddd",grid_major:"#999",grid_outer:"#000",grid_color:"#aaf",grid_font:"13px Times New Roman"});function l(l,i,r,a){var o=this,s=ne14.utils.merge(n,a);o.cellCount=0;var c,u,d,p,f,h,m=t.createElement("input"),v=t.createElement("input"),g=t.createElement("input"),b=t.createElement("div"),y=t.createElement("div"),x=t.createElement("canvas"),E=t.createElement("canvas"),S=x.getContext("2d"),w=E.getContext("2d"),C=1,k=0,L=0;m.type="button",m.value="solve",v.type="button",v.value="edit",g.type="button",g.value="photo",y.style.position="relative",E.style.position=x.style.position="absolute",y.appendChild(E),y.appendChild(x),b.appendChild(m),b.appendChild(v),b.appendChild(g),l.appendChild(b),l.appendChild(y),o.check=function(e){return e&&e.columns&&e.rows&&!isNaN(e.columns.length)&&!isNaN(e.rows.length)},o.export=function(){return M()},o.import=function(e){if(!o.check(e))throw{message:"Invalid grid"};R(e),_(e.columns.length,e.rows.length),I(),T(),O()},o.importJSON=function(e){o.import(JSON.parse(e))},o.load=function(e,t){R({columns:{length:e},rows:{length:t}}),_(e,t),I()},o.solve=function(){var e=o.export(),t=exports.Grid.solve(e);o.import(t.grid)};var _=function(e,t){var n;S.font=s.grid_font;for(var l=0;l<h.length;l++)n=h[l].join(" . "),L=Math.max(L,s.cell_size+S.measureText(n).width);for(var a=0;a<f.length;a++)n=f[a].join(" . "),k=Math.max(k,s.cell_size+S.measureText(n).width);i=e,r=t,o.cellCount=i*r,c=s.cell_size*C,u=c*i,d=c*r,E.width=x.width=(u+k)*C,E.height=x.height=(d+L)*C,w.fillStyle=s.grid_color},R=function(e){p=[],f=[],h=[];for(var t,n=[],l=0;l<e.columns.length;l++)t=(e.columns[l]||{}).labels||[],h.push(t),n.push(0);for(var i=0;i<e.rows.length;i++)t=(e.rows[i]||{}).labels||[],f.push(t),p.push((e.rows[i]||{}).cells||n.slice(0))},M=function(){for(var e,t={columns:[],rows:[]},n=0;n<i;n++)t.columns.push({labels:h[n]});for(var l=0;l<r;l++)e={labels:f[l]},p[l].join("").match(/[12]/)&&(e.cells=p[l]),t.rows.push(e);return t},I=function(){S.clearRect(0,0,u,d),S.beginPath(),S.strokeStyle=s.grid_minor;for(var e=1;e<i;e+=2)S.rect(e*c,0,c,d);for(e=1;e<r;e+=2)S.rect(0,e*c,u,c);S.stroke();var t=c*s.cell_group;S.beginPath(),S.strokeStyle=s.grid_major;for(e=s.cell_group;e<i;e+=2*s.cell_group)S.rect(e*c,0,t,d);for(e=s.cell_group;e<r;e+=2*s.cell_group)S.rect(0,e*c,u,t);S.stroke(),S.beginPath(),S.strokeStyle=s.grid_outer,S.rect(0,0,u,d),S.stroke()},T=function(){var e,t,n;S.beginPath();for(var l=0;l<p.length;l++)for(var i=0;i<p[l].length;i++)1===(e=p[l][i])?S.fillRect(c*i+1,c*l+1,c-2,c-2):2===e&&(t=c*i+c/2,n=c*l+c/2,S.moveTo(t,n),S.arc(t,n,c/8,0,2*Math.PI));S.fill()},O=function(){S.font=s.grid_font;for(var e=0;e<f.length;e++)N(e);for(var t=0;t<h.length;t++)z(t)},N=function(e){var t=s.cell_size/4,n=f[e].join(" . ");S.textAlign="left",S.clearRect(u+t,e*s.cell_size-t,k,s.cell_size),S.fillText(n,u+t,(e+1)*s.cell_size-t)},z=function(e){var t,n=s.cell_size/2,l=s.cell_size/4,i=(e+1)*s.cell_size-n;S.textAlign="center",S.clearRect(i-n,d+l,s.cell_size,L);for(var r=0;r<h[e].length;r++)t=n+l+.83*r*s.cell_size,S.fillText(h[e][r],i,t+d)},j={state:null,coords:[-1,-1]},P=function(e,t){var n=Math.max(0,Math.ceil(e/c)*c-c),l=Math.max(0,Math.ceil(t/c)*c-c),i=Math.round(n/c),r=Math.round(l/c);return{cel:{idx:[i,r],coords:[n,l,c,c]},col:{idx:i,coords:[n,0,c,E.height]},row:{idx:r,coords:[0,l,E.width,c]}}},A=function(e){var t=P(e.offsetX,e.offsetY);null!=j.state&&j.coords[0]<i&&j.coords[1]<r?t.col.idx!=j.coords[0]&&t.row.idx!=j.coords[1]||t.cel.idx+""!=j.coords+""&&0!==(p[t.row.idx]||[])[t.col.idx]||(p[t.row.idx][t.col.idx]=j.state,1==j.state?S.fillRect(t.cel.coords[0]+1,t.cel.coords[1]+1,c-2,c-2):(S.clearRect(t.cel.coords[0]+1,t.cel.coords[1]+1,c-2,c-2),2==j.state&&(S.beginPath(),S.arc(t.cel.coords[0]+c/2,t.cel.coords[1]+c/2,c/8,0,2*Math.PI),S.fill()))):t.cel.idx+""!=j.coords+""&&(j.coords=t.cel.idx,w.clearRect(0,0,E.width,E.height),t.row.idx<r&&w.fillRect.apply(w,t.row.coords),t.col.idx<i&&w.fillRect.apply(w,t.col.coords),t.row.idx<r&&t.col.idx<i&&w.clearRect.apply(w,t.cel.coords))},B=function(e){null!=j.state&&"canvas"===e.target.tagName.toLowerCase()||w.clearRect(0,0,E.width,E.height)},F=function(e){"mouseup"!==e.type.toLowerCase()&&null!=j.state||(j={state:null,coords:[-1,-1]})},U=function(e,t,n){t=(t+"").split(" ");for(var l=0;l<t.length;l++)e.addEventListener(t[l],n)},H=function(e){var n=t.createElement("div"),l=t.createElement("div"),i=t.createElement("div"),r=t.createElement("span"),a=t.createElement("div"),o=t.createElement("span");return l.className="labels",i.className="errors",n.className="ne14-popup",n.setAttribute("data-max-size",e.maxSize),a.className="buttons",o.className="btn",o.innerText="Ok",n.addEventListener("opening",J),n.addEventListener("closing",function(t){n.classList.contains("dirty")&&Y.call(n)&&confirm("Changes detected. Save?")&&X.call(n,t,e)}),o.addEventListener("click",function(t){n.classList.contains("dirty")&&!X.call(n,t,e)||ne14.utils.fire("close",n)}),D(l,e.values),i.appendChild(r),a.appendChild(o),n.appendChild(l),n.appendChild(i),n.appendChild(a),n},D=function(e,t){var n;t=t||[];for(var l=0;l<=t.length;l++)n=G(t[l]),e.appendChild(n)},G=function(e){var n=t.createElement("input");return n.value=e||"",n.maxLength=2,n.addEventListener("focus",V),n.addEventListener("input",W),n},V=function(){this.setSelectionRange(0,this.value.length)},W=function(e){var t=this.parentNode.parentNode;t.classList.add("dirty");var n=!!Y.call(t),l=""===e.target.value||e.target.nextSibling;n&&!l&&D(e.target.parentNode)},J=function(){this.getElementsByTagName("input")[0].focus(),Y.call(this)},X=function(e,t){var n=Y.call(this);if(n){var l="Row"==t.setType?f:h,i="Row"==t.setType?N:z;l[t.setIndex]=n,i(t.setIndex)}return!!n},Y=function(){for(var e,t,n,l=this.getElementsByTagName("input"),i=this.getElementsByTagName("span")[0],r=this.getAttribute("data-max-size"),a=0,o=[],s=[],c=0;c<l.length;c++)l[c].className="",""!=(e=l[c].value)&&(t=parseInt(e),isNaN(t)||t<=0?(s.push("Box "+(c+1)+" must be a valid number"),l[c].className="error"):(c>0&&a++,o.push(t),a+=t,!n&&a>r&&(s.push("Box "+(c+1)+" exceeds cell limit"),n=!0),l[c].className=n?"error":""));i.innerHTML=s.join("<br>");var u=0===s.length?o:null;return null==u?this.classList.add("invalid"):this.classList.remove("invalid"),u},K=function(e){this.focus(),this.setSelectionRange(0,this.value.length)},Q=function(e,t,n){var l="";try{o.importJSON(t.value),ne14.utils.remove(e.parentNode.parentNode)}catch(e){l=e.message}n.innerHTML=l},q=function(e,t){o.import(e),ne14.utils.remove(t.parentNode.parentNode)},Z=function(){console.log("Not solvable with current settings..")},$=e.navigator.pointerEnabled||e.navigator.msPointerEnabled,ee=Object.freeze({SUPPRESS:$?"contextmenu dragstart touchstart":"contextmenu dragstart",MOUSEUP:$?"pointerup":"mouseup",MOUSEDOWN:$?"pointerdown":"mousedown",MOUSEMOVE:$?"pointermove":"mousemove",MOUSELEAVE:$?"pointerleave":"mouseleave",MOUSEENTER:$?"pointerenter":"mouseenter"});U(x,ee.SUPPRESS,function(e){e.preventDefault()}),U(x,ee.MOUSEENTER,F),U(x,ee.MOUSEDOWN,function(e){var t=P(e.offsetX,e.offsetY),n=(p[t.row.idx]||[])[t.col.idx],l=0===n?1:1===n?2:0;3!==e.which&&2!==e.button||(l=2!==n?2:0),j.state=l,j.coords=t.cel.idx}),U(x,ee.MOUSEMOVE,A),U(x,ee.MOUSELEAVE,B),U(x,ee.MOUSEUP,A),U(x,ee.MOUSEUP,function(e){var t=P(e.offsetX,e.offsetY);if(t.cel.idx+""==j.coords+""){var n=t.col.idx<i?-1:t.row.idx<r?t.row.idx:-1,l=t.row.idx<r?-1:t.col.idx<i?t.col.idx:-1,a=f[n],o=h[l],s={values:a||o,setType:a?"Row":"Column",setIndex:Math.max(n,l),maxSize:a?i:r};if(s.setNumber=s.setIndex+1,s.values){var c=H(s);ne14.popup.init(c,{title:s.setType+" "+s.setNumber})}}}),U(e,ee.MOUSEUP,B),U(e,ee.MOUSEUP,F),U(m,"click",function(){ne14.utils.profile("Solve",o.solve)}),U(v,"click",function(){var e=function(e){var n=ne14.utils.stringify(e),l=t.createElement("div"),i=t.createElement("textarea"),r=t.createElement("div"),a=t.createElement("span"),o=t.createElement("div"),s=t.createElement("input"),c=t.createElement("input");return n=(n=(n=n.replace(/\[{/g,"[\r\n  {")).replace(/\}],/g,"}\r\n],")).replace(/\},/g,"},\r\n  "),l.className="ne14-popup",i.className="json",r.className="errors",i.value=n,s.type="button",c.type="button",s.value="Select All",c.value="Save",s.addEventListener("click",function(e){K.call(i,e)}),l.addEventListener("opening",function(e){K.call(i,e)}),c.addEventListener("click",function(e){Q(l,i,a)}),r.appendChild(a),o.appendChild(s),o.appendChild(c),l.appendChild(i),l.appendChild(r),l.appendChild(o),l}(o.export());ne14.popup.init(e,{title:"Edit JSON"})}),U(g,"click",function(){var e,n,l=(e=t.createElement("div"),n=t.createElement("div"),ne14.pxl8r.init(n,{pick_multi:!1}),e.className="ne14-popup",e.appendChild(n),n.addEventListener("testedsolvable",function(t){q(t.detail,e)}),n.addEventListener("testedunsolvable",Z),e);ne14.popup.init(l,{title:"Pixelator"})}),o.load(i,r)}e.ne14=e.ne14||{},e.ne14.fgrid={init:function(e,n,i,r){var a=t.getElementById(i+"");return a||(a=t.createElement("div"),t.body.appendChild(a)),new l(a,e,n,r)}}}(window,document),function(e){var t=Object.freeze({initial_cols:100,initial_invert:!0,initial_thresh:128,canvas_width:300,cell_padding:5,back_color:"#aaa",pick_multi:!0});function n(e,t){var n,l,r,a=e.width/e.height,o=document.createElement("canvas"),s=Math.ceil(e.width/t.cell_padding)*t.cell_padding,c=Math.round(screen.width/a);o.width=screen.width,o.height=c;var u=o.getContext("2d");u.msImageSmoothingEnabled=!1,u.mozImageSmoothingEnabled=!1,u.webkitImageSmoothingEnabled=!1,u.imageSmoothingEnabled=!1;var d=document.createElement("div"),p=document.createElement("div"),f=document.createElement("div"),h=document.createElement("div"),m=document.createElement("input"),v=document.createElement("span"),g=document.createElement("span"),b=document.createElement("a"),y=document.createElement("input"),x=document.createElement("input"),E=document.createElement("input"),S=function(){v.innerHTML="untested",n={rows:[],columns:[]};var t,a,s,d=[],p=[];u.clearRect(0,0,o.width,o.height),u.drawImage(e,0,0,l,r),i(u,l,r,function(e,t,n){var l=Math.round((e[0]+e[1]+e[2])/3)<E.value?255:0;y.checked&&(l=255-l),e[0]=e[1]=e[2]=l,e[3]=255},function(e,t,n){var l=255===e[0]?0:1;p[t]=p[t]||[],p[t].push(l),d[n]=d[n]||[],d[n].push(l)}),u.drawImage(o,0,0,l,r,0,0,screen.width,c);for(var f=0;f<d.length;f++){for(a=[],t=d[f].join("").split("0"),s=0;s<t.length;s++)0!==t[s].length&&a.push(t[s].length);n.rows.push({labels:a})}for(var h=0;h<p.length;h++){for(a=[],t=p[h].join("").split("0"),s=0;s<t.length;s++)0!==t[s].length&&a.push(t[s].length);n.columns.push({labels:a})}},w=function(){l=Math.ceil(x.value/t.cell_padding)*t.cell_padding;var e=(r=Math.ceil(x.value/a/t.cell_padding)*t.cell_padding)*t.canvas_width/l;o.style.height=e+"px",g.innerHTML=l+"x"+r,S()};return b.style.textDecoration="none",p.style.display="flex",p.style.justifyContent="space-between",p.style.alignItems="center",p.style.padding="0.3em",o.style.width="100%",o.style.maxWidth=t.canvas_width+"px",o.style.boxSizing="border-box",o.style.transition="height .6s",f.style.backgroundColor=t.back_color,f.style.display="flex",f.style.justifyContent="center",f.style.alignItems="center",f.style.padding="1px",E.style.width="60px",x.style.width="60px",h.style.display="flex",h.style.justifyContent="center",h.style.alignItems="center",h.style.padding="0.3em",d.style.margin="1em",m.setAttribute("type","button"),m.setAttribute("value","Test"),b.innerHTML="&times;",b.setAttribute("href","#"),y.setAttribute("type","checkbox"),y.setAttribute("checked",!!t.initial_invert),E.setAttribute("type","range"),E.setAttribute("min",0),E.setAttribute("max",255),E.setAttribute("value",t.initial_thresh),x.setAttribute("type","range"),x.setAttribute("max",s),x.setAttribute("min",t.cell_padding),x.setAttribute("step",t.cell_padding),x.setAttribute("value",t.initial_cols),m.addEventListener("click",function(){(new Date).getTime();var e=function(e){var t=new exports.Grid.load(e);return t.solve(),t}(n),t=e.solved,a=((new Date).getTime(),t?"solvable":"not solvable");if(!t){var s,p;u.drawImage(o,0,0,l,r),i(u,l,r,function(t,n,l){var i,r;p=(s=e._cellCache[n][l])===exports.CellState.Blank?0===t[2]?[255,0,0]:[255,223,223]:s===exports.CellState.Filled?[0,255,0]:[223,255,223],r=p,(i=t)[0]=r[0],i[1]=r[1],i[2]=r[2]}),u.drawImage(o,0,0,l,r,0,0,screen.width,c)}if(v.innerHTML=a,t){var f=d.parentNode.parentNode;ne14.utils.fire("testedsolvable",f,e.gridObject)}else ne14.utils.fire("testedunsolvable")}),b.addEventListener("click",function(){d.parentNode.removeChild(d)}),y.addEventListener("change",S),E.addEventListener("change",S),x.addEventListener("change",w),p.appendChild(m),p.appendChild(v),p.appendChild(g),p.appendChild(b),f.appendChild(o),h.appendChild(y),h.appendChild(x),h.appendChild(E),d.appendChild(p),d.appendChild(f),d.appendChild(h),w(),d}function l(e,t,l){for(var i=e.files,r=function(e){var t=new Image;t.crossOrigin="Anonymous",t.addEventListener("load",a),t.src=e.target.result},a=function(e){var i=new n(this,l);!1===l.pick_multi&&ne14.utils.empty(t),t.appendChild(i)},o=0;o<i.length;o++){var s=new FileReader;s.addEventListener("load",r),s.readAsDataURL(i[o])}e.value=""}function i(e,t,n,l,i){for(var r,a,o=e.getImageData(0,0,t,n),s="function"==typeof l,c="function"==typeof i,u=[0,0,0,0],d=0;d<t*n*4;d+=4)r=d%(4*t)/4,a=Math.floor(d/(4*t)),u[0]=o.data[d],u[1]=o.data[d+1],u[2]=o.data[d+2],u[3]=o.data[d+3],s&&l(u,r,a),o.data[d]=u[0],o.data[d+1]=u[1],o.data[d+2]=u[2],o.data[d+3]=u[3],c&&i(u,r,a);e.putImageData(o,0,0)}e.ne14=e.ne14||{},e.ne14.pxl8r={init:function(e,n){var i=ne14.utils.merge(t,n),r=e.nodeType>0?e:document.getElementById(e||"");r||(r=document.createElement("div"),document.body.appendChild(r));var a=document.createElement("input"),o=document.createElement("div");a.addEventListener("change",function(){new l(a,o,i)}),a.setAttribute("type","file"),!0===i.pick_multi&&a.setAttribute("multiple",""),r.appendChild(a),r.appendChild(o)}}}(window);</script>
  <script>
      window.addEventListener('load', function() {
        ne14.utils.profile('Load', function() {
          var grid = ne14.fgrid.init(5, 5);
          grid.import(TESTGRID_GCHQ);
        });
      });
  </script>
</head>
</html>